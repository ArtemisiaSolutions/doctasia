
<div id="loginForm">

</div>

<script type="text/javascript">

    function handleHashChange() {
        var hash = window.location.hash
        console.log(hash)
        if(hash === '') {
            displayLoginContainer()
        }
    }

    function displayLoginContainer() {
        Facade.getLoginStatus(function(err, status) {
            if(status.isFirstLogin) {
                displayCreateFirstUser('loginForm')
            } else if(status.isAuthenticated) {
                displayHomePage('loginForm')
            } else {
                displayLogin('loginForm')
            }
        })
    }

    function displayHomePage(container) {
        $('#'+container).html('Welcome ')
    }

    function displayLogin(container) {

        function verifyData() {

            if(inputUser.val().length < 3) {
                helpBlockUser.html('Username must contains at least 3 characters')
                divCtrlUser.addClass("error")
                return false
            } else {
                helpBlockUser.html('')
                divCtrlUser.removeClass("error")
            }

            if(inputPassword.val().length < 4) {
                helpBlockPassword.html('Password must contains at least 4 characters')
                divCtrlPassword.addClass("error")
                return false
            } else {
                helpBlockPassword.html('')
                divCtrlPassword.removeClass("error")
            }

            return true
        }

        var form                = $('<form action="/admins/login" method="POST" class="form-horizontal"></form>')
        var fieldset            = $('<fieldset></fieldset>')
        var legend              = $('<legend>Authenticate</legend>')
        var divUser             = $('<div class="control-group"></div>')
        var divPassword         = $('<div class="control-group"></div>')
        var divCtrlUser         = $('<div class="controls"></div>')
        var divCtrlPassword     = $('<div class="controls"></div>')
        var labelUser           = $('<label class="control-label" for="username">Username: </label>')
        var inputUser           = $('<input type="text" id="username" name="username"/>')
        var labelPassword       = $('<label class="control-label" for="password">Password: </label>')
        var inputPassword       = $('<input type="password" id="password" name="password"/>')
        var helpBlockUser       = $('<p class="help-block"></p>')
        var helpBlockPassword   = $('<p class="help-block"></p>')
        var formActions         = $('<div class="form-actions"></div>')
        var submit              = $('<button class="btn btn-primary">Sign-in</button>')

        form.append(fieldset)

        fieldset.append(legend)
        fieldset.append(divUser)
        fieldset.append(divPassword)

        fieldset.append(formActions)

        divUser.append(labelUser)
        divUser.append(divCtrlUser)

        divPassword.append(labelPassword)
        divPassword.append(divCtrlPassword)

        divCtrlUser.append(inputUser)
        divCtrlUser.append(helpBlockUser)

        divCtrlPassword.append(inputPassword)
        divCtrlPassword.append(helpBlockPassword)

        formActions.append(submit)

        $('#'+container).html(form)

    }

    function displayCreateFirstUser(container) {

        function verifyData() {

            if(inputUser.val().length < 3) {
                helpBlockUser.html('Username must contains at least 3 characters')
                divCtrlUser.addClass("error")
                return false
            } else {
                helpBlockUser.html('')
                divCtrlUser.removeClass("error")
            }

            if(inputPassword1.val().length < 4) {
                helpBlockPassword1.html('Password must contains at least 4 characters')
                divCtrlPassword1.addClass("error")
                return false
            } else {
                helpBlockPassword1.html('')
                divCtrlPassword1.removeClass("error")
            }

            if(inputPassword1.val() !== inputPassword2.val()) {
                helpBlockPassword2.html('Passwords must be the same')
                divCtrlPassword2.addClass("error")
                return false
            } else {
                helpBlockPassword2.html('')
                divCtrlPassword2.removeClass("error")
            }

            return true
        }

        var form                = $('<form action="/admins" method="POST" class="form-horizontal"></form>')
        var fieldset            = $('<fieldset></fieldset>')
        var legend              = $('<legend>This is the first login, create a user</legend>')
        var divUser             = $('<div class="control-group"></div>')
        var divPassword1        = $('<div class="control-group"></div>')
        var divPassword2        = $('<div class="control-group"></div>')
        var divCtrlUser         = $('<div class="controls"></div>')
        var divCtrlPassword1    = $('<div class="controls"></div>')
        var divCtrlPassword2    = $('<div class="controls"></div>')
        var labelUser           = $('<label class="control-label" for="username">Username: </label>')
        var inputUser           = $('<input type="text" id="username" name="name"/>')
        var labelPassword1      = $('<label class="control-label" for="password1">Password: </label>')
        var labelPassword2      = $('<label class="control-label" for="password2">Confirm password: </label>')
        var inputPassword1      = $('<input type="password" id="password1" name="pass1"/>')
        var inputPassword2      = $('<input type="password" id="password2" name="pass2"/>')
        var helpBlockUser       = $('<p class="help-block"></p>')
        var helpBlockPassword1  = $('<p class="help-block"></p>')
        var helpBlockPassword2  = $('<p class="help-block"></p>')
        var formActions         = $('<div class="form-actions"></div>')
        var submit              = $('<button class="btn btn-primary">Create user</button>')

        form.append(fieldset)

        fieldset.append(legend)
        fieldset.append(divUser)
        fieldset.append(divPassword1)
        fieldset.append(divPassword2)

        fieldset.append(formActions)

        divUser.append(labelUser)
        divUser.append(divCtrlUser)

        divPassword1.append(labelPassword1)
        divPassword1.append(divCtrlPassword1)

        divPassword2.append(labelPassword2)
        divPassword2.append(divCtrlPassword2)

        divCtrlUser.append(inputUser)
        divCtrlUser.append(helpBlockUser)

        divCtrlPassword1.append(inputPassword1)
        divCtrlPassword1.append(helpBlockPassword1)

        divCtrlPassword2.append(inputPassword2)
        divCtrlPassword2.append(helpBlockPassword2)

        formActions.append(submit)

        $('#'+container).html(form)
    }

    $('window').bind('hashchange', handleHashChange())

</script>